sort out scopes wrt lines
make decision about whether we have a context for each line - or just scopes
